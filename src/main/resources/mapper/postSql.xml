<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTDMapper3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.sns.handbook.mapper.PostMapperInter">
	<select id="getTotalCount" resultType="int">
		select count(*) from post
	</select>
	<insert id="insertPost" parameterType="PostDto">
		insert into post(user_num,post_content,post_file,post_access,post_writeday) values (#{user_num},#{post_content},#{post_file},#{post_access},now())
	</insert>
	
	<!-- 검색 기능 추가 파라미터값 변경 -->
	<select id ="postList" parameterType="Map" resultType="PostDto">
	select * from post 
	<if test="searchcolumn!=null and searchword!=null">
		<if test="searchcolumn=='post_content'">
			where ${searchcolumn} like concat('%', #{searchword}, '%')
		</if>
		<if test="searchcolumn=='user_name'">
			where user_num = any(select user_num from user where user_name = #{searchword})
		</if>
	</if>
	order by post_num desc limit 2 offset #{offset} 
	 
	</select>
	<delete id="deletePost" parameterType="int">
	delete from post where post_num=#{post_num}
	</delete>
	
	<!-- 이미지파일 수정 -->
	<update id="updatePhoto" parameterType="Map">
	  update post set post_file=#{post_file} where post_num=#{post_num}
	</update>
	
	<!-- 수정 -->
	<update id="updatePost" parameterType="PostDto">
	  update post set post_content=#{post_content},post_access=#{post_access} where post_num=#{post_num}
	</update>
	
	<select id="getDataByNum" resultType="PostDto" parameterType="String">
	   select * from post where post_num=#{post_num}
	</select>
	
</mapper>